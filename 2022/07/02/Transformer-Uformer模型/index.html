<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="å°¹ç¥ºç¿”">





<title>å›¾åƒå¤åŸä¸­çš„åº”ç”¨--Uformer | yqxBlog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
            <!-- MathJaxé…ç½®ï¼Œå¯é€šè¿‡å•ç¾å…ƒç¬¦å·ä¹¦å†™è¡Œå†…å…¬å¼ç­‰ -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- ç»™MathJaxå…ƒç´ æ·»åŠ has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- é€šè¿‡è¿æ¥CDNåŠ è½½MathJaxçš„jsä»£ç  -->
<script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


        
    


<meta name="generator" content="Hexo 5.4.2">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">BUPTyqx&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">BUPTyqx&#39;s Blog</a><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // ä¸º 6 æ—¶å±•å¼€æ‰€æœ‰
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // è¿™ä¸ªå€¼æ˜¯ç”± tocbot æºç é‡Œå®šä¹‰çš„ scrollSmoothDuration å¾—æ¥çš„
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">å›¾åƒå¤åŸä¸­çš„åº”ç”¨--Uformer</h1>
            
                <div class="post-meta">
                    
                        ğŸ¦¹â€â™€ï¸ä½œè€…: <a itemprop="author" rel="author" href="/">å°¹ç¥ºç¿”</a><br>
                    

                    
                        <span class="post-time">
                        â²ï¸æ—¶é—´: <a href="#">July 2, 2022&nbsp;&nbsp;17:31:20</a><br>
                        </span>
                    
                    
                        <span class="post-category">
                            ğŸ“’ç›®å½•:
                            
                                <a href="/categories/Transformer%E6%A8%A1%E5%9E%8B/">Transformeræ¨¡å‹</a><br>
                            
                        </span>
                    
                    
                    
                        <span class="post-count">
                            ğŸ“‘å­—æ•°:
                        <a href="">1,986</a><br>  
                        </span>
                    
                    
                        <span class="post-count">
                    â°é¢„è®¡é˜…è¯»æ—¶é—´:
                        <a href="">8min</a>  
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="Uformer"><a href="#Uformer" class="headerlink" title="Uformer"></a>Uformer</h1><h2 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h2><p>Uformeræœ‰ä¸¤ä¸ªæ ¸å¿ƒç»“æ„ï¼š</p>
<ul>
<li>å±€éƒ¨å¢å¼ºçª—transformerç»“æ„ï¼Œé‡‡ç”¨äº†åŸºäºçª—çš„è‡ªæ³¨æ„åŠ›æœºåˆ¶æ¥é™ä½ç®—åŠ›è¦æ±‚ï¼Œå¹¶åœ¨å‰é¦ˆç½‘ç»œä¸­é‡‡ç”¨æ·±åº¦å·ç§¯æ•è·æ›´å¤šå±€éƒ¨ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼›</li>
<li>é‡‡ç”¨ä¸‰ç§skip connectionç»“æ„å°†ç¼–ç å™¨ä¸­çš„ä¿¡æ¯ä¼ é€’åˆ°è§£ç å™¨ã€‚å®éªŒéƒ¨åˆ†åœ¨å»å™ªã€å»é›¨ã€å»æ¨¡ç³Šã€å»æ‘©å°”çº¹ç­‰å›¾åƒæ¢å¤ä»»åŠ¡ä¸Šè¿›è¡Œäº†æµ‹è¯•ã€‚</li>
</ul>
<h2 id="1-æ¨¡å‹ç»“æ„"><a href="#1-æ¨¡å‹ç»“æ„" class="headerlink" title="1.æ¨¡å‹ç»“æ„"></a>1.æ¨¡å‹ç»“æ„</h2><p>Uformer æ˜¯ 2 ä¸ªé’ˆå¯¹å›¾åƒå¤åŸä»»åŠ¡ (Image Restoration) çš„ Transformer æ¨¡å‹ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li>é•¿å¾—å¾ˆåƒ U-Net (åŒ»å­¦å›¾åƒåˆ†å‰²çš„ç»å…¸æ¨¡å‹)ï¼Œæœ‰Encoderï¼Œæœ‰Decoderï¼Œä¸” Encoder å’Œ Decoder ä¹‹é—´è¿˜æœ‰ Skip-Connectionsã€‚</li>
<li>åœ¨ Transformer çš„Blockä¸­èåˆäº†å·ç§¯ã€‚</li>
</ul>
<p>ä¸‹å›¾æ˜¯è®ºæ–‡ç§Uformerçš„æ¶æ„ç¤ºæ„ï¼Œä½†æ˜¯è¯¥å›¾ä¸æ˜¯å¾ˆç›´è§‚ã€‚</p>
<p><img src="/2022/07/02/Transformer-Uformer%E6%A8%A1%E5%9E%8B/image-20220227170220193.png" alt="image-20220227170220193"></p>
<p>åœ¨å®˜æ–¹çš„ä»£ç ä¸­ï¼Œæä¾›äº†æ›´åŠ å…·ä½“çš„æ¨¡å‹ç»“æ„ç¤ºæ„ã€‚ä½œè€…å·²ç»æŠŠå¼ é‡çš„ç»´åº¦æ ‡æ³¨åœ¨äº†å›¾é‡Œé¢ã€‚</p>
<ul>
<li>æ•´ä½“ç±»ä¼¼U-Net</li>
<li>æœ‰Encoderï¼Œæœ‰Decoder</li>
<li>Encoder å’Œ Decoder ä¹‹é—´è¿˜æœ‰ Skip-Connectionsè¿æ¥ã€‚</li>
</ul>
<p><img src="/2022/07/02/Transformer-Uformer%E6%A8%A1%E5%9E%8B/nn.png" alt="nn"></p>
<p><strong>1ï¼‰å·ç§¯æå–ç‰¹å¾(Input Projection)</strong></p>
<p>ç¬¬ä¸€å±‚å·ç§¯å±‚è¿›è¡Œåº•å±‚ç‰¹å¾æå–ï¼Œè¾“å…¥ä¸€ä¸ªDegraded Image$\mathbf{I} \in \mathbb{R}^{3 \times H \times W}$ï¼ŒUformeré¦–å…ˆé€šè¿‡$3\times 3$å·ç§¯å’Œ <strong>LeakyReLUæ¿€æ´»å‡½æ•°</strong>æ¥æå–åº•å±‚ç‰¹å¾ï¼Œå¾—åˆ°$\mathbf{X}_{0} \in \mathbb{R}^{C \times H \times W}$ã€‚</p>
<p><strong>2) Encoderï¼š</strong></p>
<ul>
<li>æ¥ç€$\mathbf{X}_{0} \in \mathbb{R}^{C \times H \times W}$è¿›å…¥Uå½¢ç»“æ„çš„Encoderéƒ¨åˆ†ï¼Œä¸€å…±æ˜¯$K$ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µç”±<strong>2ä¸ª LeWin Transformer Block </strong>å’Œ <strong>1ä¸ªä¸‹é‡‡æ · Down-sampling å±‚</strong>ç»„æˆã€‚<ul>
<li>LeWin Transformer Blockï¼šé¦–å…ˆæŠŠå¼ é‡ reshapeæˆ1Dçš„åºåˆ—ç‰¹å¾$\mathbf{X}^{â€˜} \in \mathbb{R}^{ HW \times C}$ï¼Œå®ƒå¯ä»¥å€ŸåŠ© Self-attention æœºåˆ¶çš„å»ºæ¨¡é•¿åºåˆ—ä¿¡æ¯çš„èƒ½åŠ›å¹¶é€šè¿‡ non-overlapping windowsçš„åŠæ³•èŠ‚çº¦è®¡ç®—é‡ã€‚</li>
<li>ä¸‹é‡‡æ · Down-sampling å±‚ï¼šé¦–å…ˆæŠŠå¼ é‡ reshapeæˆ2Dçš„ç©ºé—´ç‰¹å¾ï¼Œå†é€šè¿‡ä¸€ä¸ª$k=4,s=2$ï¼ˆæ­¥é•¿ä¸º2çš„$4\times 4$ï¼‰çš„å·ç§¯æ“ä½œè¿›è¡Œä¸‹é‡‡æ ·ï¼Œå¹¶å°†é€šé“æ•°åŠ å€ã€‚ç»è¿‡è¿™2æ­¥ä»¥åï¼Œç¬¬1ä¸ªstageè¾“å‡ºçš„å¼ é‡ç»´åº¦æ˜¯$2C\times \frac{H}{2}\times \frac{W}{2}$ï¼Œç¬¬$l$ä¸ªstageè¾“å‡ºçš„å¼ é‡ç»´åº¦æ˜¯$2^lC\times \frac{H}{2^l}\times\frac{W}{2^l}$ã€‚</li>
</ul>
</li>
</ul>
<p><strong>3) Bottleneck Stageï¼š</strong></p>
<ul>
<li>Bottleneck Stageï¼Œæœ¬è´¨ä¸Šæ˜¯é€šè¿‡2ä¸ªLeWin Transformer Blockã€‚</li>
<li>ç¼–ç å™¨çš„æœ€åä¸€å±‚å †å å¤šä¸ªLeWin transformerå—ï¼Œè¿™äº›LeWin transformerå—å¯ä»¥æ•è·åˆ°é•¿ç¨‹ä¿¡æ¯ï¼Œå¦‚æœç‰¹å¾å›¾å¤§å°å’Œå·ç§¯æ ¸å°ºå¯¸ç›¸åŒç›¸å½“äºæ˜¯å…¨å±€ä¿¡æ¯ã€‚</li>
</ul>
<p><strong>4) Decoderï¼š</strong></p>
<p>Decoder ç”¨äºç‰¹å¾çš„é‡å»ºï¼Œä¸€å…±æ˜¯$K$ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µç”± 1ä¸ªä¸Šé‡‡æ · Up-sampling å±‚ 2ä¸ª LeWin Transformer Block ç»„æˆã€‚</p>
<ul>
<li>é¦–å…ˆï¼Œä¸Šé‡‡æ ·å±‚ä¹Ÿæ˜¯å…ˆæŠŠå¼ é‡ reshapeæˆ2Dçš„ç©ºé—´ç‰¹å¾ï¼Œå†é€šè¿‡$k=2,s=2$ï¼ˆæ­¥é•¿ä¸º2ï¼Œå°ºå¯¸ä¸º$2\times 2$ï¼‰çš„ <strong>Transposed Convolution</strong>ï¼ˆè½¬ç½®å·ç§¯ï¼‰ æ‰§è¡Œï¼Œä¸Šé‡‡æ ·å±‚å¤„ç†ååˆ†è¾¨ç‡å˜ä¸º4å€ï¼Œé€šé“æ•°å‡åŠã€‚</li>
<li>å…¶æ¬¡ï¼Œè¿™ä¸ªä¸Šé‡‡æ ·åçš„ç‰¹å¾å’Œæ¥è‡ªSkip-Connectionçš„ Encoderçš„ç‰¹å¾ä¸€èµ·è¾“å…¥ LeWin Transformer Blockï¼Œé€šè¿‡å®ƒæ¥æ¢å¤ä¸¢å¤±çš„æ•°æ®ã€‚ $K$ä¸ªé˜¶æ®µå®Œæˆä»¥åï¼Œé€šè¿‡ä¸€ä¸ª3Ã—3å·ç§¯å¾—åˆ°Residual Image$\mathbf{R} \in \mathbb{R}^{3 \times H \times W}$ã€‚</li>
</ul>
<p>å®éªŒä¸­è®¾ç½®$K=4$ï¼Œå³Encoderå’Œ Decoderéƒ½æ˜¯4ä¸ªé˜¶æ®µï¼Œæ‰€ä»¥skip-connectionæœ‰3ä¸ªï¼ŒæŸå¤±å‡½æ•°æ˜¯Charbonnier lossï¼š</p>
<script type="math/tex; mode=display">
\ell\left(\mathbf{I}^{\prime}, \hat{\mathbf{I}}\right)=\sqrt{\left\|\mathbf{I}^{\prime}-\hat{\mathbf{I}}\right\|^{2}+\epsilon^{2}}</script><p>å…¶ä¸­ï¼Œ$\hat{\mathbf{I}}$æ˜¯çœŸå®å€¼ï¼Œ$\epsilon=10^{-3}$æ˜¯å¾®å°å€¼ã€‚</p>
<p>æ¦‚æ‹¬èµ·æ¥ï¼ŒUformerä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ç»“æ„ä¸Šçš„ä¸¤ç‚¹ã€‚</p>
<ul>
<li><strong>W-MSA:</strong>Window-based Multi-head Self-Attention </li>
<li><strong>LeFF:</strong>Locally-enhanced Feed-Forward Network</li>
<li><strong>Skip-Connection:</strong>(a) Concat-Skip,(b) Cross-Skip, and (c) ConcatCross-Skip.</li>
</ul>
<p><img src="/2022/07/02/Transformer-Uformer%E6%A8%A1%E5%9E%8B/skip.png" alt="skip"></p>
<h2 id="2-LeWin-Transformer-Block"><a href="#2-LeWin-Transformer-Block" class="headerlink" title="2.LeWin Transformer Block"></a>2.LeWin Transformer Block</h2><p>ä¸¤ä¸ªé‡è¦çš„ç»“è®ºï¼š</p>
<ul>
<li><strong>è®¡ç®—å…¨éƒ¨ tokens ä¹‹é—´çš„ attention æ˜¯ä¸åˆé€‚çš„ã€‚</strong>å¯¹äº Image Restoration çš„ä»»åŠ¡ä¸€èˆ¬éƒ½æ˜¯é«˜åˆ†è¾¨ç‡çš„å›¾ç‰‡ï¼Œæ¯”å¦‚1048Ã—1048çš„å›¾ç‰‡ï¼Œæ­¤æ—¶å¾—åˆ°çš„patchesæ•°é‡ä¼šå¾ˆå¤šï¼Œå¦‚æœè¿˜è®¡ç®—å…¨éƒ¨ tokens ä¹‹é—´çš„attentionçš„è¯ï¼Œè®¡ç®—é‡å¼€é”€ä¼šå˜å¾—å¾ˆå¤§ï¼ˆ$O((\text{token})^2)$ï¼‰ï¼Œæ˜¾ç„¶ä¸åˆé€‚ã€‚</li>
<li><strong>æ¯ä¸ª patch çš„ local çš„ä¸Šä¸‹æ–‡ä¿¡æ¯å¾ˆé‡è¦ã€‚</strong>å¯¹äº Image Restoration çš„ä»»åŠ¡localçš„ä¸Šä¸‹æ–‡ä¿¡æ¯å¾ˆé‡è¦ã€‚ä¸€ä¸ª degraded pixel çš„é‚»è¿‘ pixel å¯ä»¥å¸®åŠ©è¿™ä¸ª pixel å®Œæˆé‡å»ºã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œæå‡ºäº†locally-enhanced window (LeWin) Transformer blockï¼š</p>
<ul>
<li>W-MSAï¼šnon-overlapping Window-based Multi-head Self-Attention ï¼Œçª—ä¹‹é—´ä¸é‡å ï¼›</li>
<li>LeFFï¼šä¹Ÿå°±æ˜¯Locally-enhanced Feed-Forward Network (LeFF) ã€‚</li>
</ul>
<p>å› æ­¤ä¸€ä¸ªLeWin transformerå—çš„è®¡ç®—å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{array}{l}
\mathbf{X}_{l}^{\prime}=\mathrm{W}-\mathrm{MSA}\left(\mathrm{LN}\left(\mathbf{X}_{l-1}\right)\right)+\mathbf{X}_{l-1} \\
\mathbf{X}_{l}=\operatorname{LeFF}\left(\mathrm{LN}\left(\mathbf{X}_{l}^{\prime}\right)\right)+\mathbf{X}_{l}^{\prime}
\end{array}</script><h3 id="2-1-W-MSA"><a href="#2-1-W-MSA" class="headerlink" title="2.1 W-MSA"></a>2.1 W-MSA</h3><p>è¿™ä¸ªæ¨¡å—æ˜¯LeWin Transformer Block çš„ç¬¬1æ­¥ã€‚å…·ä½“è€Œè¨€ï¼Œå®ƒä¸ä½¿ç”¨å…¨éƒ¨çš„ tokens æ¥åš Self-attentionï¼Œè€Œæ˜¯åœ¨ä¸é‡å çš„å±€éƒ¨çª—å£ (non-overlapping local windows) é‡Œé¢å»åšattentionï¼Œä»¥å‡å°‘è®¡ç®—é‡ã€‚</p>
<p><img src="/2022/07/02/Transformer-Uformer%E6%A8%A1%E5%9E%8B/image-20220227172959071.png" alt="image-20220227172959071"></p>
<p>è¾“å…¥2Dçš„ç‰¹å¾å›¾$\mathbf{X}_{0} \in \mathbb{R}^{C \times H \times W}$ï¼Œå®½ä¸º$H$é«˜ä¸º$W$</p>
<ul>
<li>æŠŠè¿™ä¸ªç‰¹å¾å›¾åˆ†æˆå¤§å°ä¸º$M\times M$çš„ç›¸äº’ä¸é‡å çš„ windowsï¼ˆå¦‚ä¸Šå›¾æˆ‘ä»¬æœ‰16ä¸ª windowsï¼‰</li>
<li>å°†æ¯ä¸ªçª—çš„å›¾åƒæ‹‰ä¼¸ä¸ºä¸€ç»´ï¼ŒæŠŠæ¯ä¸ª windows çš„å¼ é‡å±•å¹³åå¾—åˆ°çš„ç»´åº¦éƒ½æ˜¯$\mathbf{X}^{i} \in \mathbb{R}^{M^2\times C}$ã€‚</li>
<li>å¯¹æ¯ä¸ª window æ‰§è¡Œ Self-attentionã€‚å‡è®¾ head çš„æ•°é‡æ˜¯$k$ ï¼Œæ¯ä¸ª head çš„ç»´åº¦æ˜¯$d_k=C/k$ã€‚åˆ™è®¡ç®—æŸä¸ª window ä¸­çš„ç¬¬$k$ä¸ª self-attention æ“ä½œå¯ä»¥å†™ä¸ºï¼š</li>
</ul>
<script type="math/tex; mode=display">
\begin{array}{l}
\mathbf{X}=\left\{\mathbf{X}^{1}, \mathbf{X}^{2}, \ldots, \mathbf{X}^{N}\right\}, \quad N=H W / M^{2}, \\
\mathbf{Y}_{k}^{i}=\operatorname{Attention}\left(\mathbf{X}^{i} \mathbf{W}_{k}^{Q}, \mathbf{X}^{i} \mathbf{W}_{k}^{K}, \mathbf{X}^{i} \mathbf{W}_{k}^{V}\right), i=1, \ldots, N, \\
\hat{\mathbf{X}}_{k}=\left\{\mathbf{Y}_{k}^{1}, \mathbf{Y}_{k}^{2}, \ldots, \mathbf{Y}_{k}^{M}\right\},
\end{array}</script><blockquote>
<ul>
<li>$\mathbf{X}^i$ä»£è¡¨ç¬¬$i$ä¸ªwindowï¼Œ$\mathbf{Y}_k^i$ä»£è¡¨ç¬¬$i$ä¸ªwindowçš„ç¬¬$k$ä¸ªheadçš„ç»“æœï¼Œ$\hat{\mathbf{X}}_{k}$ä»£è¡¨ç¬¬$k$ä¸ªheadçš„æ‰€æœ‰windowsç»¼åˆèµ·æ¥çš„ç»“æœã€‚</li>
<li>$\mathbf{W}_{k}^Q,\mathbf{W}_{k}^K,\mathbf{W}_{k}^V\in \mathbb{R}^{C \times d_k}$åˆ†åˆ«è¡¨ç¤ºç¬¬$k$ä¸ªheadçš„queriesï¼Œkeysï¼Œvaluesçš„æ˜ å°„çŸ©é˜µã€‚</li>
</ul>
</blockquote>
<p>åœ¨attention moduleé‡Œé¢ä»ç„¶é‡‡ç”¨çš„æ˜¯ç›¸å¯¹ä½ç½®ç¼–ç  (relative position encoding)ï¼Œæ‰€ä»¥attentionçš„è¡¨è¾¾å¼ä¸ºï¼š</p>
<script type="math/tex; mode=display">
\text { Attention }(\mathbf{Q}, \mathbf{K}, \mathbf{V})=\operatorname{SoftMax}\left(\frac{\mathbf{Q K}^{T}}{\sqrt{d_{k}}}+\mathbf{B}\right) \mathbf{V}</script><p>å¼å­ä¸­ï¼Œ$\mathbf{B}$æ˜¯ç›¸å¯¹ä½ç½®ç¼–ç ï¼Œå…¶å€¼æ¥è‡ªäºå¯å­¦ä¹ çš„$\hat{\mathbf{B}} \in \mathbb{R}^{(2 M-1) \times(2 M-1)}$çŸ©é˜µã€‚åœ¨è¾“å…¥ç‰¹å¾å›¾ä¸º$\mathbf{X} \in \mathbb{R}^{C \times H \times W}$ï¼Œå¦‚æœä½¿ç”¨å…¨å±€çš„self-attentionï¼Œåˆ™åºåˆ—é•¿åº¦ä¸º$N=HW$ï¼Œè®¡ç®—é‡ä¸º$O(H^2W^2C)$ï¼Œå¦‚æœä½¿ç”¨å…¨å±€W-MSAï¼Œæœ‰$\frac{H}{M}\frac{W}{M}$ä¸ªwindowsï¼Œæ¯ä¸ªwindowsçš„è®¡ç®—é‡ä¸º$M^4C$ï¼Œæ‰€ä»¥æ­¤æ—¶çš„è®¡ç®—é‡ä¸º$O(M^2HWC)$ã€‚åŒæ—¶å› ä¸ºç”¨äº†å±‚çº§ç»“æ„ï¼Œä½åˆ†è¾¨ç‡ä¸Šçš„è‡ªæ³¨æ„åŠ›æœºåˆ¶å°±å¯ä»¥è·å¾—å¾ˆå¤§çš„æ„Ÿå—é‡ï¼Œè¶³ä»¥å­¦ä¹ é•¿ç¨‹ä¿¡æ¯ã€‚</p>
<h3 id="2-2-Leff"><a href="#2-2-Leff" class="headerlink" title="2.2 Leff"></a>2.2 Leff</h3><ul>
<li>é¦–å…ˆç‰¹å¾é€šè¿‡ä¸€ä¸ª FC å±‚æ¥å¢å¤§ç‰¹å¾çš„ç»´åº¦ (feature dimension)ï¼Œå†æŠŠåºåˆ—åŒ–çš„1Dç‰¹å¾ reshape æˆ 2Dçš„ç‰¹å¾ï¼Œå¹¶é€šè¿‡ 3Ã—3 çš„ Depth-wise Convolutionæ¥å»ºæ¨¡ local çš„ä¿¡æ¯ã€‚</li>
<li>å†æŠŠ2Dçš„ç‰¹å¾ reshape æˆåºåˆ—åŒ–çš„1Dç‰¹å¾ï¼Œå¹¶é€šè¿‡ä¸€ä¸ª FC å±‚æ¥å‡å°‘ç‰¹å¾çš„ç»´åº¦åˆ°åŸæ¥çš„å€¼ï¼Œæ¯ä¸€ä¸ª FC å±‚æˆ– Depth-wise å·ç§¯å±‚åä½¿ç”¨ GeLU æ¿€æ´»å‡½æ•°ã€‚</li>
</ul>
<p><img src="/2022/07/02/Transformer-Uformer%E6%A8%A1%E5%9E%8B/image-20220227223658236.png" alt="image-20220227223658236"></p>
<h2 id="3-Skip-Connection"><a href="#3-Skip-Connection" class="headerlink" title="3.Skip-Connection"></a>3.Skip-Connection</h2><p>ä¸ºäº†ç ”ç©¶å¦‚ä½•æŠŠ Encoder é‡Œé¢çš„ low-level çš„ç‰¹å¾æ›´å¥½åœ°ä¼ é€’ç»™ Decoderï¼Œä½œè€…æ¢ç´¢äº†3ç§Skip-Connectionçš„æ–¹å¼ã€‚</p>
<p>é¦–å…ˆ Decoder ä¸­çš„æ¯ä¸ª LeWin Transformer Block è¦ç»¼åˆ2æ–¹é¢çš„ä¿¡æ¯ï¼Œå…¶ä¸€æ˜¯æ¥è‡ª Encoderçš„è¾“å‡º$E_l\in 2^{l-1}C\times \frac{H}{2^{l-1}}\times \frac{W}{2^{l-1}}$ï¼Œå…¶äºŒæ˜¯æ¥è‡ªDecoderçš„è¾“å‡º$D_{l-1}\in 2^{l-1}C\times \frac{H}{2^{l-1}}\times \frac{W}{2^{l-1}}$</p>
<ul>
<li>Concatenation-based Skip-connection (<strong>Concat-Skip</strong>)ï¼šç›´æ¥æŠŠäºŒè€…åœ¨ channel è¿™ä¸ªç»´åº¦ç»™ concatenate åœ¨ä¸€èµ·ï¼Œå¾—åˆ°çš„å¼ é‡ç»´åº¦æ˜¯$2^{l}C\times \frac{H}{2^{l-1}}\times \frac{W}{2^{l-1}}$ï¼ŒæŠŠå®ƒè¾“å…¥ç»™ W-MSA æ¨¡å—ã€‚</li>
<li>Cross-attention as Skip-connection (<strong>Cross-Skip</strong>)ï¼šç»™Decoderé˜¶æ®µçš„æ¯ä¸ª LeWin Transformer block é‡Œé¢åŠ ä¸€ä¸ªé¢å¤–çš„attention moduleï¼Œè¿™ä¸ª attention module çš„ query æ˜¯ç¬¬1ä¸ªW-MASçš„è¾“å‡ºï¼Œkey å’Œ value éƒ½æ˜¯$E_l$</li>
<li>Concatenation-based Cross-attention as Skip-connection (<strong>Concat Cross-Skip</strong>)ï¼šæŠŠäºŒè€…åœ¨ channel è¿™ä¸ªç»´åº¦ç»™ concatenate åœ¨ä¸€èµ·ï¼Œä¸”W-MSA çš„query æ˜¯$D_{l-1}$ï¼Œkey å’Œ value éƒ½æ˜¯ concat åçš„ç»“æœã€‚</li>
</ul>
<p><img src="/2022/07/02/Transformer-Uformer%E6%A8%A1%E5%9E%8B/image-20220227223956151.png" alt="image-20220227223956151"></p>
<h2 id="4-å®éªŒ"><a href="#4-å®éªŒ" class="headerlink" title="4.å®éªŒ"></a>4.å®éªŒ</h2><h3 id="4-1å®éªŒè®¾ç½®"><a href="#4-1å®éªŒè®¾ç½®" class="headerlink" title="4.1å®éªŒè®¾ç½®"></a>4.1å®éªŒè®¾ç½®</h3><ul>
<li>ä¼˜åŒ–å™¨ï¼šAdamW</li>
<li>momentumï¼š0.9,0ã€‚999</li>
<li>weight decayï¼š0.02</li>
<li>æ•°æ®å¢å¼ºï¼šhorizontal flippingï¼Œæ—‹è½¬90Â°ï¼Œ180Â°ï¼Œ270Â°ã€‚</li>
<li>å­¦ä¹ ç‡å˜åŒ–ç­–ç•¥ï¼šcosine decay strategy</li>
<li>åˆå§‹å­¦ä¹ ç‡ï¼š2e-4ï¼Œå˜åŒ–åˆ°1e-6ã€‚</li>
<li>window sizeï¼š8Ã—8ï¼Œåˆ™ä¸€ä¸ª window æ˜¯8Ã—8çš„ï¼Œä¸€ä¸ªwendowçš„åºåˆ—é•¿åº¦æ˜¯64ã€‚</li>
<li>Evaluation metricsï¼šPSNR å’Œ SSIMã€‚</li>
</ul>

        </div>

        
            <section class="post-copyright">
                
                
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/">ğŸ·ï¸è®¡ç®—æœºè§†è§‰</a>
                    
                        <a href="/tags/%E7%BC%96%E7%A8%8B/">ğŸ·ï¸ç¼–ç¨‹</a>
                    
                        <a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">ğŸ·ï¸æ·±åº¦å­¦ä¹ </a>
                    
                        <a href="/tags/Transformer/">ğŸ·ï¸Transformer</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>Â· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2022/07/02/%E6%8E%A2%E7%B4%A2%E5%A4%9A%E7%A7%8D%E5%A4%A9%E7%BA%BF%E7%9A%84%E8%BF%9C%E7%A8%8BWiFi%E4%BC%A0%E6%84%9F/">è®ºæ–‡ç¬”è®°--æ¢ç´¢å¤šç§å¤©çº¿çš„è¿œç¨‹WiFiä¼ æ„Ÿ</a>
            
            
            <a class="next" rel="next" href="/2022/07/02/VGG%E7%AC%94%E8%AE%B0/">VGGæ¨¡å‹ç¬”è®°</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© å°¹ç¥ºç¿” | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>