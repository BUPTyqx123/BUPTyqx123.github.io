<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="å°¹ç¥ºç¿”">





<title>CVä¸­çš„Attentionæœºåˆ¶ | yqxBlog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
            <!-- MathJaxé…ç½®ï¼Œå¯é€šè¿‡å•ç¾å…ƒç¬¦å·ä¹¦å†™è¡Œå†…å…¬å¼ç­‰ -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- ç»™MathJaxå…ƒç´ æ·»åŠ has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- é€šè¿‡è¿æ¥CDNåŠ è½½MathJaxçš„jsä»£ç  -->
<script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


        
    


<meta name="generator" content="Hexo 5.4.2">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">BUPTyqx&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">BUPTyqx&#39;s Blog</a><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // ä¸º 6 æ—¶å±•å¼€æ‰€æœ‰
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // è¿™ä¸ªå€¼æ˜¯ç”± tocbot æºç é‡Œå®šä¹‰çš„ scrollSmoothDuration å¾—æ¥çš„
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">CVä¸­çš„Attentionæœºåˆ¶</h1>
            
                <div class="post-meta">
                    
                        ğŸ¦¹â€â™€ï¸ä½œè€…: <a itemprop="author" rel="author" href="/">å°¹ç¥ºç¿”</a><br>
                    

                    
                        <span class="post-time">
                        â²ï¸æ—¶é—´: <a href="#">June 28, 2022&nbsp;&nbsp;21:50:24</a><br>
                        </span>
                    
                    
                        <span class="post-category">
                            ğŸ“’ç›®å½•:
                            
                                <a href="/categories/CVBaseline/">CVBaseline</a><br>
                            
                        </span>
                    
                    
                    
                        <span class="post-count">
                            ğŸ“‘å­—æ•°:
                        <a href="">2,754</a><br>  
                        </span>
                    
                    
                        <span class="post-count">
                    â°é¢„è®¡é˜…è¯»æ—¶é—´:
                        <a href="">12min</a>  
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="CVä¸­çš„Attention"><a href="#CVä¸­çš„Attention" class="headerlink" title="CVä¸­çš„Attention"></a>CVä¸­çš„Attention</h1><blockquote>
<p>ã€å‚è€ƒé“¾æ¥ã€‘</p>
<p>æœ¬æ–‡ä»¥æ¸£æ¸£çš„ç†ŠçŒ«æ½˜è€å¸ˆçš„è§†é¢‘è¯¾ä¸ºä¸»ä½“ï¼Œå‚è€ƒäº†Bubbliiiingè€å¸ˆçš„è¯¾ç¨‹ä¸­çš„ä»£ç è®²è§£ï¼ŒåŒæ—¶åœ¨é˜…è¯»äº†åŸè®ºæ–‡ååŠ å…¥äº†ä¸€äº›è‡ªå·±çš„å¿ƒå¾—å’Œä½“ä¼šï¼Œæœ¬äººæ°´å¹³æœ‰é™ï¼Œåœ¨ç†è§£è®ºæ–‡å†…å®¹å’Œä¸¤ä½è€å¸ˆçš„è¯¾ç¨‹å†…å®¹è¿‡ç¨‹ä¸­ï¼Œéš¾å…æœ‰æ‰€è¯¯è§£ï¼Œæ¬¢è¿äº¤æµæŒ‡æ­£ã€‚</p>
<p>1.ç¥ç»ç½‘ç»œå­¦ä¹ å°è®°å½•64â€”â€”Pytorch å›¾åƒå¤„ç†ä¸­æ³¨æ„åŠ›æœºåˆ¶çš„è§£æä¸ä»£ç è¯¦è§£</p>
<p>2.Pytorch å›¾åƒå¤„ç†ä¸­æ³¨æ„åŠ›æœºåˆ¶çš„ä»£ç è¯¦è§£ä¸åº”ç”¨(Bubbliiiing æ·±åº¦å­¦ä¹  æ•™ç¨‹)</p>
<p>3.bç«™upä¸» æ¸£æ¸£çš„ç†ŠçŒ«æ½˜ CVä¸­çš„æ³¨æ„åŠ›æœºåˆ¶</p>
</blockquote>
<p>â€‹        æ€»çš„æ¥è¯´ï¼Œæ³¨æ„åŠ›æœºåˆ¶èƒ½å¤Ÿçµæ´»çš„æ•æ‰å…¨å±€ä¿¡æ¯å’Œå±€éƒ¨ä¿¡æ¯ä¹‹é—´çš„è”ç³»ã€‚å®ƒçš„ç›®çš„å°±æ˜¯è®©æ¨¡å‹è·å¾—éœ€è¦é‡ç‚¹å…³æ³¨çš„ç›®æ ‡åŒºåŸŸï¼Œå¹¶å¯¹è¯¥éƒ¨åˆ†æŠ•å…¥æ›´å¤§çš„æƒé‡ï¼Œçªå‡ºæ˜¾è‘—æœ‰ç”¨ç‰¹å¾ï¼ŒæŠ‘åˆ¶å’Œå¿½ç•¥æ— å…³ç‰¹å¾ã€‚</p>
<p><img src="/2022/06/28/CV%E4%B8%AD%E7%9A%84Attention/æ³¨æ„åŠ›æœºåˆ¶æ€ç»´å¯¼å›¾.svg" alt="æ³¨æ„åŠ›æœºåˆ¶æ€ç»´å¯¼å›¾"></p>
<h2 id="1-é€šé“åŸŸæ³¨æ„åŠ›æœºåˆ¶"><a href="#1-é€šé“åŸŸæ³¨æ„åŠ›æœºåˆ¶" class="headerlink" title="1.é€šé“åŸŸæ³¨æ„åŠ›æœºåˆ¶"></a>1.é€šé“åŸŸæ³¨æ„åŠ›æœºåˆ¶</h2><h3 id="1-1-SENet"><a href="#1-1-SENet" class="headerlink" title="1.1 SENet"></a>1.1 SENet</h3><p><strong>æ„ä¹‰ï¼š</strong>è¾ƒæ—©çš„å°†attentionå¼•å…¥CNNä¸­ï¼Œæ¨¡å—åŒ–è®¾è®¡</p>
<blockquote>
<p>CNNçš„ä¸»è¦ä½œç”¨: é€šè¿‡ç³»åˆ—å·ç§¯æ ¸æå–ç‰¹å¾ã€‚ </p>
<p>å¯¹CNNçš„è¦æ±‚: ä¼˜ç§€çš„è¡¨å¾èƒ½åŠ›ï¼Œä½†æ˜¯<strong>å±€éƒ¨æ“ä½œæœ‰é™ã€‚</strong></p>
<p>æ„Ÿå—é‡: å·ç§¯ç¥ç»ç½‘ç»œæ¯ä¸€å±‚è¾“å‡ºçš„ç‰¹å¾å›¾ä¸Šçš„åƒç´ ç‚¹å¯¹åº”è¾“å…¥å›¾ç‰‡ä¸ŠåŒºåŸŸå¤§å°ï¼Œä¼¼ä¹è¦çš„æ˜¯<strong>å…¨å±€ä¿¡æ¯ã€‚</strong></p>
<p>å¢å¤§æ„Ÿå—é‡: å †å å·ç§¯å±‚ã€å¢å¤§å·ç§¯æ ¸ã€ä¸‹é‡‡æ ·ã€ç©ºæ´å·ç§¯ç­‰ã€‚</p>
</blockquote>
<p><img src="/2022/06/28/CV%E4%B8%AD%E7%9A%84Attention/image-20220303105026825.png" alt="image-20220303105026825"></p>
<p><strong>ä¸€ä¸ªç›®çš„:</strong> å¾—åˆ°ä¸€ä¸ªæƒé‡çŸ©é˜µ(<strong>æ ¸å¿ƒ</strong>)ï¼Œå¯¹ç‰¹å¾è¿›è¡Œ<strong>é‡æ„</strong>(å®ƒæ˜¯ä¸€ä¸ªå¯ä»¥ç”¨æ¥è¡¡é‡é€šé“é‡è¦æ€§çš„æ•°å€¼,ä¸Šå›¾ä¸­ç”¨ä¸åŒé¢œè‰²å±•ç¤º)</p>
<p><strong>ä¸¤ä¸ªé‡è¦æ“ä½œ:</strong> Squeeze å’Œ Excitation</p>
<p><strong>å››æ­¥èµ°:</strong> </p>
<ul>
<li><p><strong>Transformation</strong>$\mathbf{F}_{t r}$ï¼šç»™å®šä¸€ä¸ªinput$X\in \mathbb{R} ^{Hâ€™\times Wâ€™\times Câ€™}$ï¼Œè®©å…¶ç»è¿‡$\mathbf{F}_{t r}$åšä¸€æ¬¡æ˜ å°„ï¼Œå¾—åˆ°ä¸€ä¸ªoutput$U \in \mathbb{R} ^{H\times W\times C}$ï¼Œå³ï¼š$U=\mathbf{F}_{t r}(X)$ã€‚åœ¨ä¼ ç»Ÿçš„CNNä¸­ï¼Œè¿™ä¸€æ­¥å…¶å®å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å·ç§¯æ“ä½œã€‚ä½†æ˜¯ï¼Œä¸åŒçš„ç½‘ç»œå¯èƒ½æœ‰ç€ä¸åŒçš„æ“ä½œå˜æ¢ã€‚</p>
</li>
<li><p><strong>Squeeze</strong>$\mathbf{F}_{s q}$ï¼šç»™å®šä¸€ä¸ªinputï¼š$U \in \mathbb{R} ^{H\times W\times C}$ï¼Œè®©å…¶ç»è¿‡$\mathbf{F}_{s q}$åšä¸€æ¬¡å˜æ¢ï¼Œå¾—åˆ°ä¸€ä¸ªoutputï¼š$Z\in \mathbb{R} ^{1\times 1\times C}$ï¼š</p>
<script type="math/tex; mode=display">
z_{c}=\mathbf{F}_{s q}\left(\mathbf{u}_{c}\right)=\frac{1}{H \times W} \sum_{i=1}^{H} \sum_{j=1}^{W} u_{c}(i, j)</script><p><strong>å…·ä½“æ“ä½œï¼šé‡‡ç”¨å…¨å±€å¹³å‡æ± åŒ–(GAP)</strong>å°†æ¯ä¸ªé€šé“ä¸Šå¯¹åº”çš„ç©ºé—´ä¿¡æ¯$H\times W$å‹ç¼©åˆ°å¯¹åº”é€šé“ä¸­å˜ä¸º1ä¸ªæ•°å€¼ï¼Œæ­¤æ—¶1ä¸ªåƒç´ è¡¨ç¤ºä¸€ä¸ªé€šé“ï¼Œæœ€ç»ˆç»´åº¦å˜ä¸º$1\times 1 \times C$ï¼Œæˆäº†ä¸€ä¸ªå‘é‡ã€‚</p>
<p><strong>æ³¨é‡Šï¼š</strong> å¯¹$U$å®ç°å…¨å±€ä½ç»´åµŒå…¥â€”â€”å°†ç©ºé—´è¿›è¡ŒæŒ¤å‹ï¼Œç›¸å½“äºæ‹¥æœ‰äº†å…¨å±€æ„Ÿå—é‡ã€‚</p>
</li>
<li><p><strong>Excitation</strong>$\mathbf{F}_{e x}$ï¼šç»™å®šä¸€ä¸ªinputï¼š$Z\in \mathbb{R} ^{1\times 1\times C}$ï¼Œè®©å…¶ç»è¿‡$\mathbf{F}_{e x}$å¾—åˆ°ä¸€ä¸ªoutputï¼š$\mathbf{s}\in \mathbb{R} ^{1\times 1\times C}$</p>
<script type="math/tex; mode=display">
\mathbf{s}=\mathbf{F}_{e x}(\mathbf{z}, \mathbf{W})=\sigma(g(\mathbf{z}, \mathbf{W}))=\sigma\left(\mathbf{W}_{2} \delta\left(\mathbf{W}_{1} \mathbf{z}\right)\right)</script><p><strong>å…·ä½“æ“ä½œï¼š</strong>å°†ä¸Šä¸€æ­¥å¾—åˆ°çš„$Z$ç»è¿‡<strong>ä¸¤ä¸ªå…¨è¿æ¥å±‚(bottleNeck)</strong>ï¼Œå¯¹åº”ä¸Šé¢çš„$\mathbf{W}_{1}$å’Œ$\mathbf{W}_{2}$ , å…¶ä¸­$\delta$æ˜¯æ¿€æ´»å‡½æ•°Reluï¼Œ$\sigma$ä¸ºæ¿€æ´»å‡½æ•°sigmoid,æœ€ç»ˆå¾—åˆ°çš„$\mathbf{s}$<strong>å°±æ˜¯æˆ‘ä»¬æƒ³å¾—åˆ°çš„æƒé‡å€¼</strong>ã€‚å…¶ä¸­$\mathbf{W}_{1}\in \mathbb{R}^{\frac{C}{r}\times C}$ï¼Œ<script type="math/tex">\mathbf{W}_{2}\in \mathbb{R}^{C\times \frac{C}{r}}</script></p>
</li>
<li><p><strong>Scale</strong>$\mathbf{F}_{\text {scale }}$â€‹ï¼šåˆ©ç”¨ä¸Šä¸€æ­¥å¾—åˆ°çš„æƒé‡å€¼ï¼Œå¯¹åŸå§‹çš„feature mapè¿›</p>
<p>è¡Œæ“ä½œï¼Œå¾—åˆ°ä¸€ä¸ªoutput$\widetilde{\mathbf{x}}_{c}\in \mathbb{R} ^{1\times 1\times C}$ï¼š</p>
<script type="math/tex; mode=display">
\widetilde{\mathbf{x}}_{c}=\mathbf{F}_{\text {scale }}\left(\mathbf{u}_{c}, s_{c}\right)=s_{c} \cdot \mathbf{u}_{c}</script><p><strong>å…·ä½“æ“ä½œï¼š</strong>å°†å¾—åˆ°çš„æƒé‡æ–½åŠ åˆ°$U$ä¸Šé¢çš„æ¯ä¸€ä¸ªé€šé“ä¸Šã€‚å…¶å®ä¹Ÿå°±æ˜¯å¯¹äº$U$æ¯ä¸ªä½ç½®ä¸Šçš„æ‰€æœ‰$H\times W$ä¸Šçš„å€¼éƒ½ä¹˜ä¸Šå¯¹åº”é€šé“çš„æƒå€¼è€Œå·²ï¼Œå®Œæˆäº†<strong>ç‰¹å¾å›¾çš„é‡æ ¡å‡†</strong>ã€‚</p>
</li>
</ul>
<p>åº”ç”¨ï¼š</p>
<p><img src="/2022/06/28/CV%E4%B8%AD%E7%9A%84Attention/image-20220303111621428.png" alt="image-20220303111621428"></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">se_block</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, channel, ratio=<span class="number">16</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(se_block, self).__init__()</span><br><span class="line">        self.avg_pool = nn.AdaptiveAvgPool2d(<span class="number">1</span>)</span><br><span class="line">        self.fc = nn.Sequential(</span><br><span class="line">                nn.Linear(channel, channel // ratio, bias=<span class="literal">False</span>),</span><br><span class="line">                nn.ReLU(inplace=<span class="literal">True</span>),</span><br><span class="line">                nn.Linear(channel // ratio, channel, bias=<span class="literal">False</span>),</span><br><span class="line">                nn.Sigmoid()</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        b, c, _, _ = x.size()</span><br><span class="line">        y = self.avg_pool(x).view(b, c)</span><br><span class="line">        y = self.fc(y).view(b, c, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> x * y</span><br></pre></td></tr></tbody></table></figure>
<h3 id="1-2-ECANet"><a href="#1-2-ECANet" class="headerlink" title="1.2 ECANet"></a>1.2 ECANet</h3><p>é—®é¢˜ï¼šSENetç ´åäº†é€šé“ä¸æ³¨æ„åŠ›æƒé‡ä¹‹é—´çš„å…³ç³»ã€‚</p>
<p>ä¸ºäº†åˆ†æä¸Šè¿°é—®é¢˜ï¼Œä½œè€…è®¾ç½®äº†3ä¸ªSENetçš„å˜ä½“ï¼š<strong>SE-Var1ã€SE-Var2ã€SE-Var3ã€‚</strong></p>
<p><strong>SE-Var1:</strong> æ²¡æœ‰å‚æ•°ï¼Œä½†æ˜¯<strong>æ€§èƒ½ä¼˜äºBesilineï¼Œ</strong>è¯æ˜äº†é€šé“æ³¨æ„åŠ›æœºåˆ¶çš„ç¡®æœ‰æ•ˆã€‚ï¼ˆç›´æ¥sigmodï¼‰</p>
<p><strong>SE-Var2:</strong> C ä¸ªå‚æ•°ï¼Œä½†æ˜¯<strong>æ€§èƒ½ä¼˜äºSEï¼Œ</strong>è¯æ˜äº†é€šé“ä¸æƒé‡çš„ç›´æ¥è¿æ¥å¾ˆé‡è¦ã€‚</p>
<p><strong>SE-Var3:</strong> $C^2$ä¸ªå‚æ•°ï¼Œ<strong>æ€§èƒ½ä»ç„¶ä¼˜äºSEï¼Œ</strong>è¯æ˜äº†å•FCå±‚çš„è·¨é€šé“äº¤äº’æ¯”ç»´åº¦å‰Šå‡æ•ˆæœå¥½ã€‚</p>
<p><img src="/2022/06/28/CV%E4%B8%AD%E7%9A%84Attention/image-20220303113047371.png" alt="image-20220303113047371"></p>
<p><img src="/2022/06/28/CV%E4%B8%AD%E7%9A%84Attention/image-20220303113134500.png" alt="image-20220303113134500"></p>
<p><strong>å¯¹è§’çŸ©é˜µï¼š</strong>$\mathbf{W}_{\operatorname{var} 2}$å‚æ•°é‡å°‘ï¼Œä½†æ— é€šé“äº¤äº’ã€‚</p>
<p><strong>å…¨çŸ©é˜µï¼š</strong>$\mathbf{W}_{\operatorname{var} 3}$æœ‰è·¨é€šé“äº¤äº’ï¼Œä½†å‚æ•°é‡å¤§ ã€‚</p>
<script type="math/tex; mode=display">
\mathbf{W}=\left\{\begin{array}{c}
\mathbf{W}_{\operatorname{var} 2}=\left[\begin{array}{ccc}
w^{1,1} & \cdots & 0 \\
\vdots & \ddots & \vdots \\
0 & \cdots & w^{C, C}
\end{array}\right] \\
\mathbf{W}_{\operatorname{var} 3}=\left[\begin{array}{ccc}
w^{1,1} & \cdots & w^{1, C} \\
\vdots & \ddots & \vdots \\
w^{1, C} & \cdots & w^{C, C}
\end{array}\right]
\end{array}\right.</script><p>æ‰€ä»¥ï¼Œå¯ä»¥ç»¼åˆ$\mathbf{W}_{\operatorname{var} 2}$å’Œ$\mathbf{W}_{\operatorname{var} 3}$çš„ä¼˜ç‚¹ï¼Œé‡‡ç”¨åˆ†ç»„å·ç§¯$\mathbf{W}_{G}$ï¼ˆç±»ä¼¼äºçº¿æ€§ä»£æ•°ä¸­çš„åˆ†å—çŸ©é˜µçš„æ€æƒ³ï¼‰</p>
<script type="math/tex; mode=display">
\mathbf{W}_{G}=\left[\begin{array}{ccc}
\mathbf{W}_{G}^{1} & \cdots & \mathbf{0} \\
\vdots & \ddots & \vdots \\
\mathbf{0} & \cdots & \mathbf{W}_{G}^{G}
\end{array}\right]</script><p>ä½†æ˜¯æ­¤æ—¶ï¼Œåˆ†ç»„å·ç§¯çš„ç»„ä¸ç»„ä¹‹é—´çš„äº¤äº’æ¶ˆå¤±äº†ï¼Œæ‰€ä»¥æ•ˆæœå¹¶ä¸å¥½ï¼Œæ‰€ä»¥ä½œè€…æå‡ºäº†å¸¦çŠ¶çŸ©é˜µï¼ˆå‚æ•°é‡ä¸º$K\times C$ï¼Œæ¯è¡Œå‘åå¹³ç§»ä¸€ä¸ªï¼‰ï¼Œæ­¤æ—¶åŒæ—¶ä¿è¯äº†ä¿¡æ¯çš„äº¤äº’å’Œå‚æ•°çš„å‡å°‘ï¼ˆç±»ä¼¼äºä¸€ç»´å·ç§¯ï¼‰</p>
<script type="math/tex; mode=display">
\mathbf{W}_{k}=\left[\begin{array}{cccccccc}
w^{1,1} & \cdots & w^{1, k} & 0 & 0 & \cdots & \cdots & 0 \\
0 & w^{2,2} & \cdots & w^{2, k+1} & 0 & \cdots & \cdots & 0 \\
\vdots & \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots \\
0 & \cdots & 0 & 0 & \cdots & w^{C, C-k+1} & \cdots & w^{C, C}
\end{array}\right]</script><p>å·ç§¯æ ¸å¤§å°$k$çš„ç¡®å®šï¼š</p>
<p>$k$å’Œ$C$ä¹‹é—´åº”è¯¥å­˜åœ¨æŸç§å¯¹åº”å…³ç³»ï¼Œå³ï¼š</p>
<script type="math/tex; mode=display">
C=\phi(k)=2^{(\gamma * k-b)}</script><p><strong>ç»™å®š</strong>ä¸€ä¸ª$C$,å¯¹åº”çš„$k$åº”è¯¥ä¸ºï¼š</p>
<script type="math/tex; mode=display">
k=\psi(C)=\left|\frac{\log _{2}(C)}{\gamma}+\frac{b}{\gamma}\right|_{o d d}</script><p><strong>å…¶ä¸­</strong>ï¼š$r =2 ï¼Œb = 1$ï¼Œ$k$ä¸ºè®¡ç®—å‡ºæ¥ä¸´è¿‘çš„å¥‡æ•°å€¼ã€‚</p>
<p>å…·ä½“ç½‘ç»œç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="/2022/06/28/CV%E4%B8%AD%E7%9A%84Attention/image-20220303114108389.png" alt="image-20220303114108389"></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">eca_block</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, channel, b=<span class="number">1</span>, gamma=<span class="number">2</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(eca_block, self).__init__()</span><br><span class="line">        kernel_size = <span class="built_in">int</span>(<span class="built_in">abs</span>((math.log(channel, <span class="number">2</span>) + b) / gamma))</span><br><span class="line">        kernel_size = kernel_size <span class="keyword">if</span> kernel_size % <span class="number">2</span> <span class="keyword">else</span> kernel_size + <span class="number">1</span></span><br><span class="line">        self.avg_pool = nn.AdaptiveAvgPool2d(<span class="number">1</span>)</span><br><span class="line">        self.conv = nn.Conv1d(<span class="number">1</span>, <span class="number">1</span>, kernel_size=kernel_size, padding=(kernel_size - <span class="number">1</span>) // <span class="number">2</span>, bias=<span class="literal">False</span>) </span><br><span class="line">        self.sigmoid = nn.Sigmoid()</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        y = self.avg_pool(x)</span><br><span class="line">        y = self.conv(y.squeeze(-<span class="number">1</span>).transpose(-<span class="number">1</span>, -<span class="number">2</span>)).transpose(-<span class="number">1</span>, -<span class="number">2</span>).unsqueeze(-<span class="number">1</span>)</span><br><span class="line">        y = self.sigmoid(y)</span><br><span class="line">        <span class="keyword">return</span> x * y.expand_as(x)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="1-3-SKNet"><a href="#1-3-SKNet" class="headerlink" title="1.3 SKNet"></a>1.3 SKNet</h3><p><img src="/2022/06/28/CV%E4%B8%AD%E7%9A%84Attention/image-20220303120251364.png" alt="image-20220303120251364"></p>
<p><strong>ä¸€ä¸ªç›®çš„</strong>: æ¨¡æ‹Ÿè‡ªé€‚åº”è°ƒæ•´æ„Ÿå—é‡â€”â€”åŠ¨æ€é‡ç»„ç‰¹å¾</p>
<p><strong>é‡è¦ç»†èŠ‚</strong>: ç»´åº¦å˜æ¢ã€Softmaxå¤„</p>
<p><strong>ä¸‰æ­¥èµ°</strong>: </p>
<ul>
<li><strong>Split</strong>ï¼šç»™å®šä¸€ä¸ªinputï¼Œ</li>
<li><strong>Fuse</strong>ï¼š</li>
<li><strong>Select</strong></li>
</ul>
<h2 id="2-æ··åˆæ³¨æ„åŠ›æœºåˆ¶"><a href="#2-æ··åˆæ³¨æ„åŠ›æœºåˆ¶" class="headerlink" title="2.æ··åˆæ³¨æ„åŠ›æœºåˆ¶"></a>2.æ··åˆæ³¨æ„åŠ›æœºåˆ¶</h2><p><strong>ä¸ºä»€ä¹ˆæ··åˆï¼Ÿ</strong></p>
<p>ä¸åŒçš„ç»´åº¦æ‰€ä»£è¡¨çš„æ„ä¹‰æ˜¯ä¸åŒçš„ï¼Œå®ƒä»¬æœ¬èº«æ‰€æºå¸¦çš„ä¿¡æ¯ä¹Ÿæ˜¯ä¸åŒçš„ã€‚</p>
<ul>
<li>å¯¹äºé€šé“è€Œè¨€å¤šæ•°æ˜¯ç‰¹å¾æŠ½è±¡çš„è¡¨è¾¾(What)</li>
<li>å¯¹äºç©ºé—´è€Œè¨€æ‰€æ‹¥æœ‰çš„ä½ç½®ä¿¡æ¯æ›´ä¸ºä¸°å¯Œ(where)ã€‚</li>
</ul>
<h3 id="2-1-BAM"><a href="#2-1-BAM" class="headerlink" title="2.1 BAM"></a>2.1 BAM</h3><p><img src="/2022/06/28/CV%E4%B8%AD%E7%9A%84Attention/image-20220303145205246.png" alt="image-20220303145205246"></p>
<blockquote>
<p>æ€»ä½“æ¶æ„ï¼š</p>
<ul>
<li>ç»™å®šä¸€ä¸ªinputï¼š$\mathbf{F} \in \mathbb{R} ^{H\times W\times C}$ï¼Œç»è¿‡ä¸€ç³»åˆ—ä¸æ³¨æ„åŠ›æœ‰å…³çš„æ“ä½œï¼ˆ$\mathbf{M}$è¡¨ç¤ºï¼‰ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªæ³¨æ„åŠ›å‘é‡ï¼ˆAttention Vectorï¼‰ï¼Œå³ï¼š$\mathbf{F}\in\mathbb{R} ^{H\times W\times C}$</li>
<li>ä¸Šé¢çš„$\mathbf{M}$æ“ä½œåŒ…æ‹¬<strong>Channel</strong>å’Œ<strong>Spatial</strong>ä¸¤éƒ¨åˆ†ï¼š$\mathbf{M}(\mathbf{F})=\sigma\left(\mathbf{M}_{\mathbf{c}}(\mathbf{F})+\mathbf{M}_{\mathbf{s}}(\mathbf{F})\right)$</li>
<li>ç”¨ä¸Šè¿°å¾—åˆ°çš„æ³¨æ„åŠ›å‘é‡$\mathbf{M}(\mathbf{F})$å¯¹åŸç‰¹å¾å›¾è¿›è¡Œé‡æ„ï¼Œå³ï¼š$\mathbf{F}^{\prime}=\mathbf{F}+\mathbf{F} \otimes \mathbf{M}(\mathbf{F})$</li>
</ul>
</blockquote>
<p><strong>ä¸€ä¸ªç›®çš„:</strong> ç”Ÿæˆæ··åˆåŸŸçš„<strong>æ³¨æ„åŠ›å‘é‡</strong>â€”â€”<strong>å¯¹åŸç‰¹å¾è¿›è¡Œé‡æ„</strong></p>
<p><strong>ä¸‰ä¸ªåˆ†æ”¯:</strong> </p>
<ul>
<li><p><strong>Channel  branch</strong> ï¼šç»™å®šä¸€ä¸ªinputï¼Œå¯¹äº$\mathbf{F} \in \mathbb{R} ^{H\times W\times C}$ï¼Œç»è¿‡é€šé“æ³¨æ„åŠ›<strong>SEblock</strong>çš„æ“ä½œï¼Œå¾—åˆ°$\mathbf{M_c(F)} \in \mathbb{R} ^{C\times 1\times 1}$ï¼Œå…·ä½“çš„å¤„ç†æ–¹å¼æ˜¯ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
\mathbf{M}_{\mathbf{c}}(\mathbf{F}) &=B N(\operatorname{MLP}(\operatorname{AvgPool}(\mathbf{F}))) \\
&=B N\left(\mathbf{W}_{\mathbf{1}}\left(\mathbf{W}_{\mathbf{0}} \operatorname{Avg} \operatorname{Pool}(\mathbf{F})+\mathbf{b}_{\mathbf{0}}\right)+\mathbf{b}_{\mathbf{1}}\right)
\end{aligned}</script><p>å…¶ä¸­ï¼š$\mathbf{W}_{\mathbf{0}} \in \mathbb{R}^{C / r \times C}, \mathbf{b}_{\mathbf{0}} \in \mathbb{R}^{C / r}, \mathbf{W}_{\mathbf{1}} \in \mathbb{R}^{C \times C / r}, \mathbf{b}_{\mathbf{1}} \in \mathbb{R}^{C} $</p>
</li>
<li><p><strong>Spatial branch</strong>ï¼šç»™å®šä¸€ä¸ªinputï¼Œå¯¹äº$\mathbf{F} \in \mathbb{R} ^{H\times W\times C}$ï¼Œ,å…ˆè¿›è¡Œé™ç»´,å³ç»è¿‡$1*1$çš„å·ç§¯ï¼Œç„¶åé€šè¿‡ä¸¤ä¸ª${3\times3}$çš„ç©ºæ´å·ç§¯ï¼Œå†é€šè¿‡${1\times1}$å·ç§¯ï¼Œå¾—åˆ°$\mathbf{M_s(F)}\in \mathbb{R} ^{1\times H\times W}$ï¼Œå…·ä½“æè¿°å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
\mathbf{M}_{\mathbf{s}}(\mathbf{F})=B N\left(f_{3}^{1 \times 1}\left(f_{2}^{3 \times 3}\left(f_{1}^{3 \times 3}\left(f_{0}^{1 \times 1}(\mathbf{F})\right)\right)\right)\right)</script><p>è¿™é‡Œé‡‡ç”¨ç©ºæ´å·ç§¯çš„ç›®çš„æ˜¯<strong>å¢å¤§æ„Ÿå—é‡</strong>ï¼Œå¦å¤–ä¸ºäº†ç®€å•åŒ–,é™ç»´å‚æ•°è®¾ä¸º$C/r$</p>
</li>
<li><p><strong>Combine branch</strong>ï¼šå‰é¢å·²ç»æåˆ°äº†é€šé“æ³¨æ„åŠ›$\mathbf{M_c(F)}$ï¼Œç©ºé—´æ³¨æ„åŠ›$\mathbf{M_s(F)}$ï¼Œç°åœ¨éœ€è¦å°†äºŒè€…è”åˆèµ·æ¥ç”Ÿæˆæœ€ç»ˆçš„æ³¨æ„åŠ›ç‰¹å¾å›¾$\mathbf{M(F)}$ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯<strong>äºŒè€…ç»´åº¦ä¸åŒ</strong>ï¼Œéœ€è¦éƒ½å…ˆè°ƒæ•´ä¸º$\mathbb{R} ^{H\times W\times C}$å†è¿›è¡Œåç»­è¿ç®—ï¼Œå…·ä½“æ“ä½œä¸ºï¼š</p>
<script type="math/tex; mode=display">
\mathbf{M}(\mathbf{F})=\sigma\left(\mathbf{M}_{\mathbf{c}}(\mathbf{F})+\mathbf{M}_{\mathbf{s}}(\mathbf{F})\right)\\
\mathbf{F}^{\prime}=\mathbf{F}+\mathbf{F} \otimes \mathbf{M}(\mathbf{F})</script><p>å¸¸è§çš„èåˆæ–¹æ³•æœ‰ä¸‰ç§: <strong>summation, multiplication, max operation</strong> ã€‚</p>
</li>
</ul>
<p><strong>é‡è¦ç»†èŠ‚:</strong> ä¸åŒåˆ†æ”¯çš„æ··åˆå¤„ã€ç»´åº¦å˜æ¢</p>
<p>å¤šBAMæ„å»ºäº†ä¸€ä¸ª<strong>å±‚æ¬¡åŒ–</strong>çš„æ³¨æ„åŠ›ï¼Œå’Œäººç±»çš„æ„ŸçŸ¥è¿‡ç¨‹å¾ˆåƒã€‚</p>
<p><img src="/2022/06/28/CV%E4%B8%AD%E7%9A%84Attention/image-20220303150739456.png" alt="image-20220303150739456"></p>
<h3 id="2-2-CBAM"><a href="#2-2-CBAM" class="headerlink" title="2.2 CBAM"></a>2.2 CBAM</h3><p><img src="/2022/06/28/CV%E4%B8%AD%E7%9A%84Attention/image-20220303155015829.png" alt="image-20220303155015829"></p>
<ul>
<li><p><strong>Channel  branch</strong> ï¼šç»™å®šä¸€ä¸ªinputï¼Œå¯¹äº$\mathbf{F} \in \mathbb{R} ^{H\times W\times C}$ï¼ŒåŒæ—¶ç»è¿‡å…¨å±€å¹³å‡æ± åŒ–(<strong>GAP</strong>)å’Œå…¨å±€æœ€å¤§æ± åŒ–(<strong>GMP</strong>)æ“ä½œ,åˆ†åˆ«å¾—åˆ°ä¸åŒçš„ç©ºé—´è¯­ä¹‰æè¿°ç®—å­ï¼Œå°†äºŒè€…é€šè¿‡ä¸€ä¸ª<strong>å…±äº«æ„ŸçŸ¥æœº</strong>ï¼Œéšåå°†ä¸¤ä¸ªé€šé“æ³¨æ„åŠ›ç‰¹å¾å‘é‡ä½¿ç”¨ç›¸åŠ æ–¹å¼è¿›è¡Œèåˆï¼Œæœ€åç»è¿‡æ¿€æ´»å‡½æ•°ï¼Œå¾—åˆ°é€šé“æ³¨æ„åŠ›å‘é‡$\mathbf{M_c} \in \mathbb{R} ^{C\times 1\times 1}$ï¼Œè¯¦ç»†æè¿°å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
\mathbf{M}_{\mathbf{c}}(\mathbf{F}) &=\sigma(\operatorname{MLP}(\operatorname{AvgPool}(\mathbf{F}))+\operatorname{MLP}(\operatorname{MaxPool}(\mathbf{F}))) \\
&=\sigma\left(\mathbf{W}_{\mathbf{1}}\left(\mathbf{W}_{\mathbf{0}}\left(\mathbf{F}_{\mathbf{a v g}}^{\mathbf{c}}\right)\right)+\mathbf{W}_{\mathbf{1}}\left(\mathbf{W}_{\mathbf{0}}\left(\mathbf{F}_{\mathbf{m a x}}^{\mathbf{c}}\right)\right)\right)
\end{aligned}</script><p>å…¶ä¸­ï¼Œ$\sigma$è¡¨ç¤ºsigmodå‡½æ•°ï¼Œ$\mathbf{W}_{\mathbf{0}}\in\mathbb{R} ^{C/r\times C},\mathbf{W}_{\mathbf{1}}\in\mathbb{R} ^{C\times C/r}$ï¼ŒMLPæ˜¯å…±äº«æƒé‡çš„ã€‚</p>
</li>
<li><p><strong>Spatial branch</strong> <strong>:</strong> ç»™å®šä¸€ä¸ªinputï¼Œå¯¹äº$\mathbf{F} \in \mathbb{R} ^{H\times W\times C}$ï¼Œæ²¿ç€<strong>é€šé“ç»´åº¦</strong>åŒæ—¶ç»è¿‡å…¨å±€å¹³å‡æ± åŒ–(<strong>GAP</strong>)å’Œå…¨å±€æœ€å¤§æ± åŒ–(<strong>GMP</strong>)æ“ä½œ,åˆ†åˆ«å¾—åˆ°ä¸¤ç§ä¸åŒçš„é€šé“ç‰¹å¾æè¿°ç®—å­ï¼Œå°†äºŒè€…è¿›è¡Œæ‹¼æ¥ï¼Œç„¶åç»è¿‡ä¸€ä¸ªå·ç§¯æ ¸ä¸º${7*7}$çš„å·ç§¯æ“ä½œï¼Œå†ç»è¿‡æ¿€æ´»å‡½æ•°ï¼Œæœ€åå¾—åˆ°ç©ºé—´æ³¨æ„åŠ›å‘é‡$\mathbf{M_s} \in \mathbb{R} ^{1\times H\times W}$ï¼Œè¯¦ç»†è¡¨è¿°å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
\mathbf{M}_{\mathbf{s}}(\mathbf{F}) &=\sigma\left(f^{7 \times 7}([\operatorname{AvgPool}(\mathbf{F}) ; \operatorname{MaxPool}(\mathbf{F})])\right) \\
&=\sigma\left(f^{7 \times 7}\left(\left[\mathbf{F}_{\mathrm{avg}}^{\mathrm{s}} ; \mathbf{F}_{\max }^{\mathrm{s}}\right]\right)\right),
\end{aligned}</script></li>
<li><p>æ··åˆï¼š</p>
<ul>
<li><strong>Parallel</strong> å¹¶è¡Œï¼šé€šé“æ³¨æ„åŠ›ç‰¹å¾å›¾+ç©ºé—´æ³¨æ„åŠ›ç‰¹å¾å›¾= æ··åˆæ··åˆæ³¨æ„åŠ›ç‰¹å¾å›¾å¯¹<strong>åŸç‰¹å¾å›¾$F$</strong>è¿›è¡Œæ ¡æ­£ã€‚</li>
<li><strong>Sequential</strong>ä¸²è¡Œï¼šé€šé“æ³¨æ„åŠ›ç‰¹å¾å›¾å¯¹åŸç‰¹å¾å›¾$F$è¿›è¡ŒçŸ«æ­£=$Fâ€™$ï¼Œç©ºé—´æ³¨æ„åŠ›ç‰¹å¾å›¾å¯¹ç‰¹å¾å›¾$Fâ€™$å†è¿›è¡Œæ ¡æ­£ã€‚</li>
</ul>
</li>
</ul>
<p><img src="/2022/06/28/CV%E4%B8%AD%E7%9A%84Attention/image-20220303155948388.png" alt="image-20220303155948388"></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ChannelAttention</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, in_planes, ratio=<span class="number">8</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(ChannelAttention, self).__init__()</span><br><span class="line">        self.avg_pool = nn.AdaptiveAvgPool2d(<span class="number">1</span>)</span><br><span class="line">        self.max_pool = nn.AdaptiveMaxPool2d(<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># åˆ©ç”¨1x1å·ç§¯ä»£æ›¿å…¨è¿æ¥</span></span><br><span class="line">        self.fc1   = nn.Conv2d(in_planes, in_planes // ratio, <span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line">        self.relu1 = nn.ReLU()</span><br><span class="line">        self.fc2   = nn.Conv2d(in_planes // ratio, in_planes, <span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line">        self.sigmoid = nn.Sigmoid()</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        avg_out = self.fc2(self.relu1(self.fc1(self.avg_pool(x))))</span><br><span class="line">        max_out = self.fc2(self.relu1(self.fc1(self.max_pool(x))))</span><br><span class="line">        out = avg_out + max_out</span><br><span class="line">        <span class="keyword">return</span> self.sigmoid(out)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpatialAttention</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, kernel_size=<span class="number">7</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(SpatialAttention, self).__init__()</span><br><span class="line">        <span class="keyword">assert</span> kernel_size <span class="keyword">in</span> (<span class="number">3</span>, <span class="number">7</span>), <span class="string">'kernel size must be 3 or 7'</span></span><br><span class="line">        padding = <span class="number">3</span> <span class="keyword">if</span> kernel_size == <span class="number">7</span> <span class="keyword">else</span> <span class="number">1</span></span><br><span class="line">        self.conv1 = nn.Conv2d(<span class="number">2</span>, <span class="number">1</span>, kernel_size, padding=padding, bias=<span class="literal">False</span>)</span><br><span class="line">        self.sigmoid = nn.Sigmoid()</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        avg_out = torch.mean(x, dim=<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        max_out, _ = torch.<span class="built_in">max</span>(x, dim=<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        x = torch.cat([avg_out, max_out], dim=<span class="number">1</span>)</span><br><span class="line">        x = self.conv1(x)</span><br><span class="line">        <span class="keyword">return</span> self.sigmoid(x)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">cbam_block</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, channel, ratio=<span class="number">8</span>, kernel_size=<span class="number">7</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(cbam_block, self).__init__()</span><br><span class="line">        self.channelattention = ChannelAttention(channel, ratio=ratio)</span><br><span class="line">        self.spatialattention = SpatialAttention(kernel_size=kernel_size)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x = x * self.channelattention(x)</span><br><span class="line">        x = x * self.spatialattention(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></tbody></table></figure>

        </div>

        
            <section class="post-copyright">
                
                
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/">ğŸ·ï¸è®¡ç®—æœºè§†è§‰</a>
                    
                        <a href="/tags/%E7%BC%96%E7%A8%8B/">ğŸ·ï¸ç¼–ç¨‹</a>
                    
                        <a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">ğŸ·ï¸æ·±åº¦å­¦ä¹ </a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>Â· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2022/06/29/pytorch%E6%97%A5%E7%A7%AF%E6%9C%88%E7%B4%AF1-%E5%BC%A0%E9%87%8F%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/">pytorchæ—¥ç§¯æœˆç´¯-å¼ é‡æ•°æ®ç±»å‹</a>
            
            
            <a class="next" rel="next" href="/2022/06/28/GCN/">å›¾å·ç§¯ç¥ç»ç½‘ç»œçš„åŠç›‘ç£åˆ†ç±»(GCN)</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© å°¹ç¥ºç¿” | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>